<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>UGC Intranet</title>
    <link rel="icon" type="image/x-icon" href="/static/img/logo/favicon.ico"></title>

    <!-- Custom fonts for this template-->
    <link href="static/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet"> 

    <!-- Custom styles for this template-->
    <link href="static/css/sb-admin-2.min.css" rel="stylesheet">
    <link href="static/css/my_custom_css.css" rel="stylesheet">
    <!-- Bootstrap styles for this template-->
    <link href="static/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="static/vendor/bootstrap/css/bootstrap-datetimepicker.min.css" rel="stylesheet">

    <link rel="stylesheet" href="static/css/dtsel.css" />
    
    <!-- Icons -->
    <link rel="stylesheet" type="text/css" href="static/assets/css/fontawesome.css">

    <!--Slick slider css-->
    <link rel="stylesheet" type="text/css" href="static/assets/css/slick.css">
    <link rel="stylesheet" type="text/css" href="static/assets/css/slick-theme.css">

    <!-- Animate icon -->
    <link rel="stylesheet" type="text/css" href="static/assets/css/animate.css">

    <!-- Themify icon -->
    <link rel="stylesheet" type="text/css" href="static/assets/css/themify-icons.css">

    <!-- Bootstrap css -->
    <link rel="stylesheet" type="text/css" href="static/assets/css/bootstrap.css">

    <!-- Theme css 
    <link rel="stylesheet" type="text/css" href="static/assets/css/color8.css" media="screen" id="color"> -->
    
     <!--Google font-->
     
     <link rel="stylesheet" href="static/vendor/bootstrap/css/toastr.min.css"/>
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
     Style Sheets -->        
        <script>
            jQuery.noConflict();
        // Code that uses other library's $ can follow here.
        </script>
    
    {% block head %} {% endblock %}
</head>

<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Sidebar -->

        
        <!-- End of Sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column" style="background-image: url('/static/img/images/aeriel.jpg');background-repeat: no-repeat;background-attachment: fixed;background-size: cover;background-size: 100% 100%;">

            <!-- Main Content -->
            <div id="content" style="background-image: url('/static/img/images/aeriel.jpg');background-repeat: no-repeat;background-attachment: fixed;background-size: cover;background-size: 100% 100%;">

                <!-- Topbar -->
                <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow" style="background-image: url('/static/img/images/tower.jpg');background-repeat: no-repeat;background-attachment: fixed;background-size: cover;background-size: 100% 100%;">

                    <!-- Sidebar Toggle (Topbar) -->                    

                    <!-- Topbar Search -->                    
                    <a class="sidebar-brand d-flex align-items-center justify-content-center" href="/">
                        <div class="sidebar-brand-icon"><!-- rotate-n-15">-->
                                <!-- <i class="fas fa-laugh-wink"></i>-->
                            <img src="/static/img/logo/ugee.png" alt="UGEE CHEMICALS LOGO" width="50px" height="50px">
                        </div>
                        <div class="sidebar-brand-text mx-3">Welcome to UGEE CHEMICALS</div>
                    </a>
                    <!-- Topbar Navbar -->
                    
                </nav> 
                {% with messages = get_flashed_messages() %}
                    {% if messages %}
                    
                    <nav class="row align-items-center justify-content-center">
                        {% for message in messages %}
                        <div class="col-md-12">
                            <div class="text-center">{{message}}</div>
                        </div>
                        {% endfor %}
                    </nav>
                    {% endif %}
                {% endwith %}
                <!-- End of Topbar -->

                {% block content %} {% endblock %}

            </div>
            <!-- End of Main Content -->

            <!-- Footer -->
            <footer class="sticky-footer bg-white">
                <div class="container my-auto">
                    <div class="copyright text-center my-auto">
                        <span>Copyright &copy; UGEE CHEMICALS LIMITED 2022</span>
                    </div>
                </div>
            </footer>
            <!-- End of Footer -->

        </div>
        <!-- End of Content Wrapper -->

    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

    <!-- Logout Modal-->
    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">Ã—</span>
                    </button>
                </div>
                <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                    <a class="btn btn-primary" href="login.html">Logout</a>
                </div>
            </div>
        </div>
    </div>
    
<!-- Default bootstrap modal example -->        
<div class="modal fade bs-modal-lg" id="stop-insert-modal" tabindex="-1" role="basic" aria-labelledby="myModalLabel" aria-hidden="true" >        
        <div class="modal-dialog modal-lg">     
            <div class="modal-content" >                      
                           
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                        <h6 style="text-align: center" class="modal-title text-center">Insert New Stop Event</h6>
                    </div>
                    <div class="modal-body">
                        
                        
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary" data-dismiss="modal" style="float:left;">Insert</button>
                    </div>                       
            </div>      
        </div>      
    </div>

        <!-- Default bootstrap modal example -->        
<div class="modal fade bs-modal-lg" id="ajaxlarge" tabindex="-1" role="basic" aria-labelledby="myModalLabel" aria-hidden="true" >       
    <div class="modal-dialog modal-lg">     
        <div class="modal-content" >        
            <div class="modal-body">        
                       
                <span> &nbsp;&nbsp;Loading... </span>       
            </div>      
        </div>      
    </div>      
</div>

    <!-- Bootstrap core JavaScript-->
   <!-- <script src="static/vendor/jquery/jquery.min.js"></script> -->
    <script src="static/vendor/jquery/jquery.slim.min.js"></script>
    <script src="static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="static/vendor/bootstrap/js/bootstrap.min.js"></script>
   <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.6.0/umd/popper.min.js" integrity="sha512-BmM0/BQlqh02wuK5Gz9yrbe7VyIVwOzD1o40yi1IsTjriX/NGF37NyXHfmFzIlMmoSIBXgqDiG1VNU6kB5dBbA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->

    <!-- Core plugin JavaScript-->
    <script src="static/vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="static/js/sb-admin-2.min.js"></script>

    <!-- Page level plugins -->
    <script src="static/vendor/chart.js/Chart.min.js"></script>

    <!-- Page level custom scripts -->
    <script src="static/js/demo/chart-area-demo.js"></script>
    <script src="static/js/demo/chart-pie-demo.js"></script>
    <!--sweet alert -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js" integrity="sha512-AA1Bzp5Q0K1KanKKmvN/4d3IRKVlv9PYgwFPvm32nPO6QS8yH1HO7LbgB1pgiOxPtfeg5zEn2ba64MUcqJx6CA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.37/js/bootstrap-datepicker.min.js"></script>
    <script src="static/js/dtsel.js"></script>
    <script src="static/vendor/bootstrap/js/toastr.min.js"></script>
   <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
     jQuery Scripts 
      <!-- latest jquery
      <script src="static/assets/js/jquery-3.3.1.min.js"></script>
      <!-- fly cart ui jquery
      <script src="static/assets/js/jquery-ui.min.js"></script>  
      <!-- exitintent jquery
      <script src="static/assets/js/jquery.exitintent.js"></script>
      <script src="static/assets/js/exit.js"></script>  
      <!-- popper js
      <script src="static/assets/js/popper.min.js"></script>  
      <!-- slick js
      <script src="static/assets/js/slick.js"></script>  
      <!-- menu js
      <script src="static/assets/js/menu.js"></script> -->  
      <!-- lazyload js
      <script src="static/assets/js/lazysizes.min.js"></script>  
      <!-- Bootstrap js
      <script src="static/assets/js/bootstrap.js"></script>        
      <!-- Bootstrap Notification js
      <script src="static/assets/js/bootstrap-notify.min.js"></script>  
      <!-- Fly cart js
      <script src="static/assets/js/fly-cart.js"></script>  
      <!-- Theme js
      <script src="static/assets/js/script.js"></script> -->

    
<script>
//this will restrict users from checking more than two boxes at a time//
$('input.mergeBox').click(function(event){
    var chekLimit=3;
    var chekedBox = document.querySelectorAll('input[name="merger"]:checked').length;
    if(chekedBox >= chekLimit) {
        
       event.preventDefault();
       alert('You\'re not allowed to choose more than 2 boxes');

   }
})

//this will process and merge the stop//
function mergeTwoStops(machine){
    var checked = document.querySelectorAll('input[name="merger"]:checked');
    var count = document.querySelectorAll('input[name="merger"]:checked').length;
    //check that a stop event has been selected//
    if (count==0){
        alert('Please select Two stops to be merged by checking the checkboxes against the stops.');
    }else if(count<2){
        alert('Please select the second stop to be merged with the already selected stop.')
    }else if (count==2){
        console.log(checked[0].value,checked[1].value);        
        var data=JSON.stringify({stop1:checked[0].value,stop2:checked[1].value,machine:machine});

        fetch(`/modstop?data=${data}&action=${'MERGE_STOP'}`)
                    .then(function (response) {
                            return response.json();
                        }).then(function (text) {                                
                                
                                alert(text.message);
                                //toastr.success(text.message);
                                //toastr.success('Have fun storming the castle!', 'Miracle Max Says')
                                window.setTimeout('location.reload()', 2000);

                            });    
    }else{

    }
    

}


  //instance = new dtsel.DTS('input[name="dateTimePicker"]');
  instance = new dtsel.DTS('input[name="dateTimePicker1"]',  {
  showTime: true, dateFormat: "yyyy-mm-dd",timeFormat: "HH:MM:SS.00"
});
  instance = new dtsel.DTS('input[name="dateTimePicker2"]',  {
  showTime: true, dateFormat: "yyyy-mm-dd",timeFormat: "HH:MM:SS.00"
});
 //handle input to select fields //
 function populateSelectFields(id,events){
    for (var i = 0; i < events.length; i++) {
        var option = "<option value='"+events[i].value+"'>"+events[i].stop+"</option>";
        $(id).append(option);
        
    }
 }
//show the breakdown field in the stops update page
function showBrdwn(x,y){
    if($(x).val()){
    $(".brkdwn"+y).css("display","block");
} else {
    $(".brkdwn"+y).css("display","none");
}
}



 var StopErrors = [{'stop':'Machine Stopped By Operator','value':0},{'stop':'Photoeye Fault','value':3},{'stop':'End Product','value':34},{'stop':'Horizontal Jaw Electric Current Limit','value':5},{'stop':'Horizontal Jaw: Servodrive Fault','value':36},{'stop':'Unwind Film Fault','value':7},{'stop':'Auger: Servodrive Fault','value':37},{'stop':'End Film','value':8},{'stop':'General Emergency Button Pressed','value':39},{'stop':'Temperature out of range Horiz.Jaw: Front','value':10},{'stop':'Coder Fault','value':48},{'stop':'Temperature out of range Vertical Jaw: Front','value':12},{'stop':'Local Emergency Button Pressed','value':49},{'stop':'Max temperature limit Horiz.Jaw: Front','value':16},{'stop':'Air Pressure Fault','value':52},{'stop':'Film Alignment: Right Limit','value':29},{'stop':'2D No Read','value':59},{'stop':'Safety Door 1 openned','value':30},{'stop':'2D No Match','value':60},{'stop':'Power Fault','value':32},{'stop':'Safety Disconnect Switch Heating','value':68},{'stop':'Safety Disconnect Switch Front Opened','value':67},{'stop':'DR Device Fault','value':69},{'stop':'Thermocouple 3 opened','value':73}];
populateSelectFields('#stop_error',StopErrors); 

 var StopClasses = [{'stop':'BFS','value':6},{'stop':'Multilane Machine','value':7},{'stop':'Pack Material','value':5},{'stop':'Production Plan','value':2},{'stop':'Planned Stop','value':4},{'stop':'UVA Machine','value':8},{'stop':'Utilities','value':1}];
populateSelectFields('#stop_class',StopClasses);
populateSelectFields('.ur1',StopClasses);


///code for handling the selecfields for inserting stops///

function fetchReason(select,field,id){
    var value= $(select).children(':selected').val();
    
    fetch(`/fetchreasons?id=${value}&field=${field}`)
                    .then(function (response) {
                            return response.json();
                        }).then(function (text) { 

                                $('#'+id).html(text.message);
                                //alert(text.message);

                            });
}

function insertStop(machine,url){
    var timeNow=new Date();
    var start=$('.start_date').val();
    var end=$('.end_date').val();
    var error=$('#stop_error').val();
    var r1=$('#stop_class').val();var r2=$('#stop_trans').val();
    var r3=$('#stop_comp').val(); var r4=$('#stop_mode').val(); 
    var r5=$('#stop_conc').val();
    var comment=$('#stop_comment').val();
    if (start==''){
       return alert('Please enter Start date and time');
    }else if (end==''){
        return alert('Please enter End date and time');
    }else if (error==''){
       return alert('Please select one fault');
    }else if (new Date(String(start))>timeNow || new Date(String(end))>timeNow){
       return alert('One of your datetime is beyond the current time.');
    }else if (new Date(String(start)) > new Date(String(end))){
       return alert('The Start datetime cannot be further than the End datetime');
    }else{
        if (r5){
            brk=r5
        }else{
            brk=0
        }
        var data=JSON.stringify({start:start,end:end,error:error,r1:r1,r2:r2,r3:r3,r4:r4,r5:brk,comment:comment,url:url,machine:machine});

        fetch(`/insertstopevent?data=${data}`)
                    .then(function (response) {
                            return response.json();
                        }).then(function (text) {                                
                                
                                //alert(text.message);
                                $(".stop_insert_div").css("display","none");
                                //toastr.success(text.message);
                                //toastr.success('Have fun storming the castle!', 'Miracle Max Says')
                                    window.setTimeout('location.reload()', 2000);

                            });

    }
    
}
//function for updating stops//

function updateSTOP(id){
    var r1=$("#ur1"+id).val();var r2=$("#ur2"+id).val();var r3=$("#ur3"+id).val();var r4=$("#ur4"+id).val();
    var r5=$("#ur5"+id).val();var comment=$("#comm"+id).val();
    if (r5){
            brk=r5
        }else{
            brk=0
        }
        var data=JSON.stringify({r1:r1,r2:r2,r3:r3,r4:r4,r5:brk,comment:comment,sid:id});

        fetch(`/modstop?data=${data}&action=${'UPDATE_STOP'}`)
                    .then(function (response) {
                            return response.json();
                        }).then(function (text) {                                
                                
                                alert(text.message);
                                //toastr.success(text.message);
                                //toastr.success('Have fun storming the castle!', 'Miracle Max Says')
                                //window.setTimeout('location.reload()', 2000);

                            });

}

//delete stop function//

function deleteItem(data){
  var sid=data;
  var row=$(".row"+sid);
  Swal.fire({
        title: 'Are you sure you wan to delete this stop event?',        
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, proceed'
      }).then((result) => {
        if (result.value) {
          
            fetch(`/modstop?sid=${sid}&action=${"DELETE_STOP"}`)
                    .then(function (response) {
                            return response.json();
                        }).then(function (text) {
                                row.css('display','none');
                                alert(text.message);

                            });
         
            
            
        }
      })
}

//set the width of the stop reason cells//
function setInitialCellWidth (div,selct){
    //var e = document.getElementById(selct);
    //e.options[e.selectedIndex].value;
    //e.options[e.selectedIndex].text;

    var valu=$(selct).val();    
    var text=$(selct).find(":selected").text(); //$(selct).text(); 

    if (valu && valu!=0){
        var len = text.length * 14;
        $(div).css("width",len);
        console.log(len);
    }    
}

function setCommentCellWidth (div,inpt){
    var text = $(inpt).val();

    if (text && text!="none"){
        var len = text.length * 14;
        $(div).css("width",len);
        console.log(len);
    }

}

//get the values for the updated stops//

fetch(`/fetchreasons?id=${2}&field=${"fetch_all"}`)
                    .then(function (response) {
                            return response.json();
                        }).then(function (text) {                                
                               for (var i = 0; i < text.message.length; i++) {
                                var rem=text.message[i];
                                $("#ur1"+rem.sid).val(rem.r1);
                                setInitialCellWidth (".ur1div"+rem.sid,"#ur1"+rem.sid);

                                $("#ur2"+rem.sid).html("<option value='"+rem.r2+"'>"+rem.reas2+"</option>");
                                setInitialCellWidth (".ur2div"+rem.sid,"#ur2"+rem.sid);

                                $("#ur3"+rem.sid).html("<option value='"+rem.r3+"'>"+rem.reas3+"</option>");
                                setInitialCellWidth (".ur3div"+rem.sid,"#ur3"+rem.sid);

                                $("#ur4"+rem.sid).html("<option value='"+rem.r4+"'>"+rem.reas4+"</option>");
                                setInitialCellWidth (".ur4div"+rem.sid,"#ur4"+rem.sid);

                                if (rem.r5==1){
                                    $("#ur5"+rem.sid).html("<option value='"+rem.r5+"'>Breakdown</option>");
                                    setInitialCellWidth (".ur5div"+rem.sid,"#ur5"+rem.sid);   
                                }else{
                                    //$("#ur5"+rem.sid).html("<option value=''></option>"); 
                                }
                                $("#comm"+rem.sid).val(rem.comment);
                                setCommentCellWidth(".commdiv"+rem.sid,"#comm"+rem.sid);

                                }                                
                            });

//})

</script>
    {% block tail %} {% endblock %}


</body>

</html>